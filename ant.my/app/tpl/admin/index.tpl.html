<!DOCTYPE html>
<html lang="ru" data-bs-theme="light" id="html-root">
{* *}
{* *}

<head>
    {include file="admin/head.tpl.html"}
</head>
{* *}
{* *}

<body>
    <input type="hidden" id="current_sub">
    <input type="hidden" id="primary_key">
    <!-- /header -->
    {* Навигация *}
    {include file="admin/offcanvas.tpl.html"}
    <header class="border-bottom" data-bs-theme="dark">
        {include file="admin/header.tpl.html"}
    </header><!-- /header -->
    {* *}
    {* Основной контейнер *}
    <div class="container-fluid" style="max-width: 1900px;">
        {* Flash-сообщение (например, "Сессия истекла") *}
        {assign var="flash" value=Flight::session()->get('flash_message')}
        {if $flash}
                <div class="alert alert-success alert-dismissible fw-lighter m-3" role="alert">
                    {$flash}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
        {assign var="tmp" value=Flight::session()->delete('flash_message')}
        {/if}
        <div class="row">
            <aside class="col-xl-3 col-xxl-2 d-none d-xl-block p-0 bg-body-tertiary border-right user-select-none">
                {include file="admin/aside.tpl.html"}
            </aside>
            <main class="col-xl-9 ms-sm-auto col-xxl-10 px-lg-4 bg-white">
                {include file="admin/main.tpl.html"}
                {block ERROR_MESSAGE}

                {* Проверка GET-параметра через Smarty *}
                {if isset($smarty.get.error)}
                    <div class="alert alert-danger alert-dismissible fade show d-flex align-items-center" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i> {* Иконка Bootstrap Icons (если подключены) *}
                        <div>
                            {if $smarty.get.error == 'banned'}
                                <strong>Доступ заблокирован!</strong> Ваш аккаунт был деактивирован администратором. Пожалуйста, свяжитесь с поддержкой.
                            {elseif $smarty.get.error == '1'}
                                <strong>Ошибка!</strong> Неверный логин или пароль.
                            {else}
                                <strong>Внимание!</strong> Произошла ошибка при авторизации.
                            {/if}
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {/if}

                {$app|debug_print_var}
                {/block}
            </main>
        </div>
    </div>
    {* *}
    {* Footer *}
    <footer class="fixed-bottom text-center py-3 mt-4 border-top bg-body-secondary">
        {include file="admin/footer.tpl.html"}
    </footer>
    {* *}
    <!-- Контейнер для тостов -->
    <div class="toast-container position-fixed bottom-0 start-0 p-3">
        <div id="sessionToast" class="toast align-items-center text-white bg-info border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    <strong>Внимание!</strong> Сессия скоро истечет. Нажмите любую клавишу, чтобы остаться.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>
    {* Bootstrap JS *}
    <script src="/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    {* Дополнительные скрипты *}
    {block name="scripts"}
    {* Подключаем основной файл как модуль (если он нужен для побочных эффектов) *}
    <script type="module" src="/lib/admin.js"></script>
    {/block}
    {* Шаблон Smarty 5 *}
    {if isset($session_timeout_seconds)}
    <script type="module">
        // Импортируем именно нашу функцию из файла
     {literal}import { initSessionTimer } from '/lib/admin.js';{/literal}
        // Вызываем её
        initSessionTimer({$session_timeout_seconds|default:1800});
    </script>
    {/if}
</body>